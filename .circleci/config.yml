version: 2.1

working_directory: ~/project
parameters:
  environment:
    type: string
    default: DEV
    description: "Environment to run to"
  service:
    type: string
    default: NA
    description: "Service to run"
steps:
  - checkout
  - newman/newman-run:
      collection: https://api.getpostman.com/collections/${COMPOSITION_COLLECTION_UID}?apikey=${POSTMAN_API_KEY}
      environment: https://api.getpostman.com/environments/${DEV_ENV_UID}?apikey=${POSTMAN_API_KEY}
      additional-options: --ignore-redirects -r cli,junit --reporter-junit-export xml-file-reports
      context:
        - automation
  - store_artifacts:
      path: ~/project/newman
  - store_test_results:
      path: test-results